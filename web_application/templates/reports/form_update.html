<section class="report-section">
    <h1>Generate Report</h1>
    <p>Fill out the form below to create a custom report:</p>
    
    <form method="POST" id="reportForm" class="report-form">
        <div class="form-group">
            <label for="title">Report Title:</label>
            <input type="text" id="title" name="title" required placeholder="Enter report title" value="{{ data.title }}" oninput="updatePreview()">
        </div>
    
        <div class="form-group">
            <label for="description">Description:</label>
            <textarea id="description" name="description" required placeholder="Enter report description" oninput="updatePreview()">{{ data.description }}</textarea>
        </div>
    
        <div class="form-group">
            <label for="data">Additional Data (JSON):</label>
            <textarea id="data" name="data" required placeholder='{"key": "value"}' oninput="updatePreview()">{{ data.json_data | tojson }}</textarea>
        </div>
    
        <div class="form-actions">
            <button type="button" id="editButton" class="btn btn-secondary">Edit</button>
            <button type="submit" name="save" id="saveButton" class="btn btn-primary">Save</button>
            <button type="submit" name="default" id="defaultButton" class="btn btn-light">Default</button>
        </div>
    </form>
</section>

<script>
    document.getElementById('editButton').addEventListener('click', function() {
        // Get all elements that need to be made editable
        const editableElements = [
            document.getElementById('editableTitle'),
            document.getElementById('editableDescription'),
            document.getElementById('editableSummary'),
            document.getElementById('editableScope'),
            document.getElementById('editableMethodology')
        ];
        
        // Toggle the contenteditable attribute for each section
        editableElements.forEach(element => {
            if (element.getAttribute('contenteditable') === 'false') {
                element.setAttribute('contenteditable', 'true');
            } else {
                element.setAttribute('contenteditable', 'false');
            }
        });
        
        // Optionally change the button text to indicate "Edit Mode" or "Save Mode"
        if (this.innerText === 'Edit') {
            this.innerText = 'Stop Editing';
        } else {
            this.innerText = 'Edit';
        }
    });

    document.getElementById('reportForm').onsubmit = function(event) {
        event.preventDefault();  // Prevent form from reloading the page

        let formData = new FormData(this);  // Collect form data

        // Add the edited content to the form data
        formData.append('title', document.getElementById('editableTitle').innerText);
        formData.append('description', document.getElementById('editableDescription').innerText);
        formData.append('executive_summary', document.getElementById('editableSummary').innerText);
        formData.append('scope', document.getElementById('editableScope').innerText);
        formData.append('methodology', document.getElementById('editableMethodology').innerText);
        
        // Use AJAX to submit the form without refreshing the page
        fetch('/save_report', {
            method: 'POST',
            body: formData
        }).then(response => {
            return response.json();
        }).then(data => {
            // Handle the response, update preview, or show a success message
            console.log('Report saved successfully!');
        }).catch(error => {
            console.error('Error:', error);
        });
    };
</script>
